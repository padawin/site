
function HeapQueue(a){this.cmp=(a||function(d,c){return d-c});this.length=0;this.data=[]}HeapQueue.prototype.data=function(){return this.data.length};HeapQueue.prototype.peek=function(){return this.data[0]};HeapQueue.prototype.push=function(c){this.data.push(c);var d=this.data.length-1,b,a;while(d>0){b=(d-1)>>>1;if(this.cmp(this.data[d],this.data[b])<0){a=this.data[b];this.data[b]=this.data[d];this.data[d]=a;d=b}else{break}}return this.length++};HeapQueue.prototype.pop=function(){var b=this.data.pop(),d=this.data[0];if(this.data.length>0){this.data[0]=b;var h=0,f=this.data.length-1,g,e,c,a;while(1){g=(h<<1)+1;e=g+1;c=h;if(g<=f&&this.cmp(this.data[g],this.data[c])<0){c=g}if(e<=f&&this.cmp(this.data[e],this.data[c])<0){c=e}if(c!==h){a=this.data[c];this.data[c]=this.data[h];this.data[h]=a;h=c}else{break}}}else{d=b}this.length--;return d};loader.addModule("pathFinding",function(){function c(e){return e.x+"-"+e.y}function d(f,e){return Math.abs(f.x-e.x)+Math.abs(f.y-e.y)}function a(f,i,e){var h=e,g=[h];while(h!=i){h=f[c(h)];if(!h){g=[];break}g.push(h)}g.reverse();return g}var b={astar:function(e,f,i){if(f.x==i.x&&f.y==i.y){return[]}var l={},g={},m,k,h,j,n,o;k=new HeapQueue(function(q,p){return q.priority-p.priority});f.priority=0;k.push(f);l[c(f)]=null;g[c(f)]=0;while(k.length>0){m=k.pop();if(m==i){break}h=e.getNeighbours(m);for(j in h){n=c(h[j]);o=g[c(m)]+1;if(!(n in g)||o<g[n]){g[n]=o;j.priority=o+d(i,h[j]);k.push(h[j]);l[n]=m}}}return a(l,f,i)}};return b});loader.addModule("inventory","B",function(c){var a=[],b={};b.add=function(e){a.push(e);var f,d=c.create("li",{"data-index":a.length},"inventory-list");c.create("img",{src:e.icon,alt:e.name},d);f=c.create("span",{text:e.name},d);if(e.onopen){c.on(d,"click",e.onopen)}};return b});loader.addModule("screenSize","B",function(d){var b,a={get:function(){return b}};function c(){b={w:Math.max(document.documentElement.clientWidth,window.innerWidth||0),h:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}}c();window.addEventListener("resize",function(f){d.addClass(document.body,"hidden");c();d.removeClass(document.body,"hidden");d.Events.fire("resize",[b])},false);return a});loader.addModule("message","B",function(d){var b,a,c;b={init:function(){a=d.$id("message");c=d.$sel("#message .content")[0]},show:function(e){c.innerText=e;d.removeClass(a,"hidden")},hide:function(){c.innerText="";d.addClass(a,"hidden")},};return b});loader.addModule("canvas","B",function(c){var b={},a;b.canvas=c.$id("myCanvas");a=b.canvas.getContext("2d");b.getContext=function(){return a};b.resize=function(d){this.canvas.width=d.w;this.canvas.height=d.h};b.getWidth=function(){return this.canvas.width};b.getHeight=function(){return this.canvas.height};b.drawRectangle=function(e,i,f,d,h,g){if(h){a.fillStyle=h;a.fillRect(e,i,f,d)}if(g){a.strokeStyle=g;a.strokeRect(e,i,f,d)}};return b});loader.addModule("GUI","canvas","B",function(a,c){var b={progressBar:function(d,l,g,j,i,f,k,e){if(i>1){i=1}a.drawRectangle(d,l,g,j,k,f);if(i>0){a.drawRectangle(d,l,g*i,j,e,e)}},tabs:function(){var f=c.$sel(".tabs li"),d;function e(g){return function(){var i,h;c.removeClass(g.parentNode.querySelectorAll(".active")[0],"active");c.addClass(g,"active");h=c.$id(g.getAttribute("rel")).parentNode;for(i=0;i<h.children.length;i++){if(h.children[i].id==g.getAttribute("rel")){c.removeClass(h.children[i],"hidden")}else{c.addClass(h.children[i],"hidden")}}}}for(d=0;d<f.length;d++){if(!c.hasClass(f[d],"active")){c.addClass(f[d].getAttribute("rel"),"hidden")}c.on(f[d],"click",e(f[d]))}},collapsable:function(){var d=c.$sel(".quest h3"),e;function f(g){return function(){if(c.hasClass(g.parentNode,"active")){c.removeClass(g.parentNode,"active")}else{c.addClass(g.parentNode,"active")}}}for(e=0;e<d.length;e++){c.on(d[e],"click",f(d[e]))}}};return b});loader.addModule("sprites",function(){var b="images/sprite.png",a={nbResources:1,spriteResource:null,SPRITES_ACCESS:{STAIR:2,FLOWERS:3,PLAYER_RIGHT:9,PLAYER_LEFT:10,PLAYER_MOVE_LEFT:11,PLAYER_MOVE_RIGHT:12,PLAYER_MOVE_UP_LEFT:13,PLAYER_MOVE_UP_RIGHT:14,WALL:15,SCROLL:16,ROCK:17,SMALL_ROCK:18,TREE:19,TREE_LARGE:20,TABLE:21,CAMERA:22,OCTOCAT:23,FLOODIT:24},sprites:[{x:0,y:0,w:64,h:36,d:73,neighbours:{left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}}},{x:64,y:0,w:64,h:36,d:73,neighbours:{left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}}},{x:128,y:0,w:64,h:36,d:73,neighbours:{left:{x:-1,y:0},up:{x:0,y:-1},right:{x:2,y:1},down:{x:0,y:1}}},{neighbours:{left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},animation:[{x:192,y:0,w:64,h:36,d:73},{x:256,y:0,w:64,h:36,d:73}]},{animation:[{x:320,y:0,w:64,h:36,d:73},{x:384,y:0,w:64,h:36,d:73}]},{x:448,y:0,w:64,h:36,d:73,neighbours:{left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}}},{x:512,y:0,w:64,h:36,d:73,neighbours:{left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}}},{x:576,y:0,w:64,h:36,d:73,neighbours:{left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}}},{x:640,y:0,w:64,h:36,d:73,neighbours:{left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}}},{x:0,y:73,w:28,h:60,posInCell:{x:14,y:52}},{x:28,y:73,w:28,h:60,posInCell:{x:14,y:52}},{animation:[{x:56,y:73,w:36,h:60,posInCell:{x:18,y:52}},{x:92,y:73,w:20,h:60,posInCell:{x:8,y:52}},{x:112,y:73,w:36,h:60,posInCell:{x:18,y:52}},{x:148,y:73,w:20,h:60,posInCell:{x:8,y:52}}]},{animation:[{x:168,y:73,w:36,h:60,posInCell:{x:18,y:52}},{x:204,y:73,w:20,h:60,posInCell:{x:8,y:52}},{x:224,y:73,w:36,h:60,posInCell:{x:18,y:52}},{x:260,y:73,w:20,h:60,posInCell:{x:8,y:52}}]},{animation:[{x:280,y:73,w:36,h:60,posInCell:{x:18,y:52}},{x:316,y:73,w:20,h:60,posInCell:{x:8,y:52}},{x:336,y:73,w:36,h:60,posInCell:{x:18,y:52}},{x:372,y:73,w:20,h:60,posInCell:{x:8,y:52}}]},{animation:[{x:392,y:73,w:36,h:60,posInCell:{x:18,y:52}},{x:428,y:73,w:20,h:60,posInCell:{x:8,y:52}},{x:448,y:73,w:36,h:60,posInCell:{x:18,y:52}},{x:484,y:73,w:20,h:60,posInCell:{x:8,y:52}}]},{x:0,y:133,w:64,h:73,d:73,posInCell:{x:32,y:55}},{animation:[{x:64,y:133,w:38,h:73,d:73,posInCell:{x:19,y:57}},{x:102,y:133,w:38,h:73,d:73,posInCell:{x:19,y:57}},{x:64,y:133,w:38,h:73,d:73,posInCell:{x:19,y:57}},{x:140,y:133,w:38,h:73,d:73,posInCell:{x:19,y:57}}]},{x:178,y:138,w:42,h:26,posInCell:{x:23,y:18}},{x:166,y:200,w:54,h:21,posInCell:{x:26,y:12}},{x:220,y:133,w:58,h:82,posInCell:{x:30,y:72}},{x:504,y:76,w:79,h:144,posInCell:{x:30,y:125}},{x:278,y:136,w:108,h:78,posInCell:{x:60,y:50}},{animation:[{x:583,y:73,w:42,h:42,posInCell:{x:20,y:30}},{x:583,y:115,w:42,h:44,posInCell:{x:20,y:32}},{x:583,y:73,w:42,h:42,posInCell:{x:20,y:30}},{x:583,y:159,w:42,h:40,posInCell:{x:20,y:28}}]},{x:386,y:135,w:76,h:66,posInCell:{x:38,y:58}},{x:626,y:73,w:42,h:84,posInCell:{x:22,y:58}}],loadResources:function(c){a.spriteResource=new Image();a.spriteResource.onload=c;a.spriteResource.src=b}};return a});loader.addModule("level","sprites",function(a){var b=null;return{gridCellsDimensions:{w:64,h:36},ground:[[0,0,2,b,b,b,b,b,b,b,6,6,6,6,6,6,6,6,6,b,b,b,1,1,1,1,1,1,1,3,0,0,0,0],[3,b,b,b,0,3,b,b,b,b,6,6,6,6,6,6,6,6,6,b,b,b,1,1,1,1,1,1,1,0,0,0,0,0],[b,b,8,3,0,b,b,8,0,0,6,6,6,6,6,6,6,6,6,b,b,b,1,1,1,1,1,1,1,0,0,0,3,0],[b,0,0,2,b,b,8,0,0,0,6,6,6,6,6,6,6,6,6,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[b,b,b,b,b,1,1,0,0,0,6,6,6,6,6,6,6,6,6,b,b,b,1,1,1,1,1,1,1,0,0,0,0,0],[b,b,0,3,0,0,1,0,0,0,6,6,6,6,6,6,6,6,6,b,7,b,1,1,1,1,1,1,1,0,0,0,0,0],[b,b,0,0,0,0,1,0,0,0,6,6,6,6,6,6,6,6,6,b,7,b,1,1,1,1,1,1,1,0,0,0,0,0],[b,b,0,0,0,0,1,3,0,0,0,0,0,0,1,3,0,0,0,b,7,b,0,0,0,0,0,0,0,0,3,0,0,0],[b,b,0,0,0,0,1,1,1,1,1,1,1,1,1,0,3,0,0,b,7,b,3,0,0,0,0,0,0,0,0,0,0,0],[b,b,b,0,0,3,0,1,0,0,0,0,0,0,0,0,0,0,0,b,7,b,0,0,0,0,0,0,0,0,0,0,0,0],[b,b,b,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,b,7,b,0,0,0,0,3,0,0,0,0,0,0,3],[b,b,b,0,0,0,0,1,2,b,b,b,b,b,b,b,b,b,b,b,8,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,0,0,0,0,0,b,b,1,1,1,1,1,1,3,0,0,0,0,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,0,0,3,0,0,b,7,0,0,0,0,0,1,0,0,0,0,0,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,8,0,0,0,0,0,1,0,0,0,0,0,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,0,0,0,0,0,0,0,5,5,5,5,1,0,0,0,0,0,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,4,4,4,4,5,5,4,4,4,4,4,5,5,5,5,4,4,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,4,4,4,4,4,4,4,4,4,4,4,4,5,4,5,4,4,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b]],walkables:[[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0],[1,0,0,0,1,1,0,0,0,0,0,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1],[0,1,1,1,0,0,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],objects:[{x:10,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:10,y:1,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:10,y:2,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:10,y:3,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:10,y:4,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:10,y:5,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:10,y:6,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:11,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:12,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:13,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:14,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:15,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:16,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:17,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:18,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:18,y:1,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:18,y:2,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:18,y:4,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:18,y:5,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:18,y:6,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:17,y:6,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:16,y:6,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:15,y:6,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:13,y:6,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:12,y:6,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:11,y:6,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:14,y:3,sprite:a.sprites[a.SPRITES_ACCESS.SCROLL],canBeTaken:true,name:"CV",icon:"images/cv.png",onopen:function(){window.open("http://www.ghislain-rodrigues.fr/CV-Ghislain-Rodrigues.pdf")}},{x:7,y:13,sprite:a.sprites[a.SPRITES_ACCESS.ROCK]},{x:20,y:14,sprite:a.sprites[a.SPRITES_ACCESS.ROCK]},{x:18,y:7,sprite:a.sprites[a.SPRITES_ACCESS.ROCK]},{x:11,y:15,sprite:a.sprites[a.SPRITES_ACCESS.SMALL_ROCK]},{x:13,y:10,sprite:a.sprites[a.SPRITES_ACCESS.SMALL_ROCK]},{x:2,y:5,sprite:a.sprites[a.SPRITES_ACCESS.SMALL_ROCK]},{x:4,y:10,sprite:a.sprites[a.SPRITES_ACCESS.TREE]},{x:10,y:7,sprite:a.sprites[a.SPRITES_ACCESS.TREE]},{x:8,y:3,sprite:a.sprites[a.SPRITES_ACCESS.TREE_LARGE]},{x:1,y:3,sprite:a.sprites[a.SPRITES_ACCESS.TREE_LARGE]},{x:19,y:12,sprite:a.sprites[a.SPRITES_ACCESS.TREE_LARGE]},{x:14,y:1,sprite:a.sprites[a.SPRITES_ACCESS.TABLE]},{x:4,y:12,sprite:a.sprites[a.SPRITES_ACCESS.CAMERA],canBeTaken:true,name:"My pictures",icon:"images/camera.png",onopen:function(){window.open("http://travels.ghislain-rodrigues.fr/")}},{x:17,y:17,sprite:a.sprites[a.SPRITES_ACCESS.OCTOCAT],canBeTaken:true,name:"Github",icon:"images/Octocat.png",onopen:function(){window.open("https://github.com/padawin/")}},{x:22,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:28,y:0,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:22,y:6,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:28,y:6,sprite:a.sprites[a.SPRITES_ACCESS.WALL]},{x:25,y:8,sprite:a.sprites[a.SPRITES_ACCESS.TREE]},{x:32,y:5,sprite:a.sprites[a.SPRITES_ACCESS.TREE_LARGE]},{x:25,y:3,sprite:a.sprites[a.SPRITES_ACCESS.FLOODIT],canBeTaken:true,name:"Floodit",icon:"/images/floodit.png",onopen:function(){window.open("https://github.com/padawin/floodit-clone")}},]}});loader.addModule("camera","canvas",function(b){var a=b.getContext(),c;c={x:0,y:0,w:0,h:0,subject:null,adapt:function(e){var d={x:Math.round(e.x-(this.x-this.w/2)),y:Math.round(e.y-(this.y-this.h/2))};return d},toWorldCoords:function(e){var d={x:e.x+(this.x-this.w/2),y:e.y+(this.y-this.h/2),};return d},setSubject:function(d){this.subject=d},setPosition:function(d){this.x=d.x;this.y=d.y},update:function(){if(!this.subject){return}var d={x:c.x,y:c.y};if(c.w/2-(this.subject.x-c.x)<135){d.x=this.subject.x-(c.w/2-135)}else{if(c.w/2-(c.x-this.subject.x)<135){d.x=this.subject.x+(c.w/2-135)}}if(c.h/2-(this.subject.y-c.y)<135){d.y=this.subject.y-(c.h/2-135)}else{if(c.h/2-(c.y-this.subject.y)<135){d.y=this.subject.y+(c.h/2-135)}}this.setPosition(d)},draw:function(){a.strokeStyle="black";a.beginPath();a.moveTo(this.w/2,0);a.lineTo(this.w/2,this.h);a.stroke();a.beginPath();a.moveTo(0,this.h/2);a.lineTo(this.w,this.h/2);a.stroke()}};return c});loader.addModule("character","sprites","canvas","inventory","B",function(g,c,f,h){var a=c.getContext();function b(j,i){return Math.sqrt(Math.pow(i.x-j.x,2)+Math.pow(i.y-j.y,2))}function e(i){var j={x:i.path[0].x-i.cell.x,y:i.path[0].y-i.cell.y,};if(j.x>0){i.sprite=g.sprites[g.SPRITES_ACCESS.PLAYER_MOVE_RIGHT]}else{if(j.y>0){i.sprite=g.sprites[g.SPRITES_ACCESS.PLAYER_MOVE_LEFT]}else{if(j.x<0){i.sprite=g.sprites[g.SPRITES_ACCESS.PLAYER_MOVE_UP_LEFT]}else{if(j.y<0){i.sprite=g.sprites[g.SPRITES_ACCESS.PLAYER_MOVE_UP_RIGHT]}}}}}function d(){this.path=[];this.frame=0;this.maxFrame=4;this.tick=0;this.timePerFrame=8;this.sprite=g.sprites[g.SPRITES_ACCESS.PLAYER_RIGHT];this.maxLinearSpeed=2;this.speed={x:0,y:0}}d.prototype.calculateSpeed=function(i){var j=b({x:0,y:0},i);if(j<=this.maxLinearSpeed){this.speed=i}else{this.speed.x=i.x*this.maxLinearSpeed/j;this.speed.y=i.y*this.maxLinearSpeed/j}};d.prototype.setCell=function(l,i,n){var m,k,j;if(this.cell){k=this.cell}this.cell={x:i,y:n};if(k){j=l.getObject(this.cell);if(j&&j!=this){f.add(j);h.Events.fire("message",[j.name+" added to the inventory"])}l.moveObject(k,this.cell)}else{l.addObject(this,this.cell)}m=l.coordsToPixels(this.cell.x,this.cell.y);this.x=m.x;this.y=m.y};d.prototype.setPath=function(i){this.path=i};d.prototype.update=function(k){var j,i;if(!this.path.length){if(this.speed!=={x:0,y:0}){this.frame=0;if(this.speed.x>0){this.sprite=g.sprites[g.SPRITES_ACCESS.PLAYER_RIGHT]}else{if(this.speed.y>0){this.sprite=g.sprites[g.SPRITES_ACCESS.PLAYER_LEFT]}}this.speed={x:0,y:0}}return}j=k.coordsToPixels(this.path[0].x,this.path[0].y);i={x:j.x-this.x,y:j.y-this.y};this.calculateSpeed(i);this.updatePosition();this.updateFrame();e(this);if(this.x==j.x&&this.y==j.y){this.setCell(k,this.path[0].x,this.path[0].y);this.path.shift()}};d.prototype.updatePosition=function(){this.x+=this.speed.x;this.y+=this.speed.y};d.prototype.updateFrame=function(){this.tick++;if(this.tick==this.timePerFrame){this.tick=0;this.frame=(this.frame+1)%this.maxFrame}};d.prototype.draw=function(j){var k=j.adapt(this),i;i=this.sprite;if(i.animation!==undefined){i=i.animation[this.frame]}a.drawImage(g.spriteResource,i.x,i.y,i.w,i.h,k.x-i.posInCell.x,k.y-i.posInCell.y,i.w,i.h)};return d});loader.addModule("object","sprites","canvas",function(d,b){var c,a=b.getContext();c=function(e){if(!e.draw){e.draw=function(g,h){var i,f;i=g.adapt(h.coordsToPixels(e.x,e.y));f=e.sprite;if(f.animation!==undefined){e.tick++;if(e.tick==e.timePerFrame){e.tick=0;e.frame=(e.frame+1)%f.animation.length}f=f.animation[e.frame]}a.drawImage(d.spriteResource,f.x,f.y,f.w,f.h,i.x-f.posInCell.x,i.y-f.posInCell.y,f.w,f.h)}}if(e.sprite.animation){e.frame=0;e.tick=0;e.timePerFrame=16}return e};return c});loader.addModule("map","sprites","canvas","object","B",function(i,e,f,c){var g=e.getContext(),d,h=1,k=0,a;function j(m){var n=document.createElement("canvas"),l=n.getContext("2d");l.beginPath();l.moveTo(d.x,0);l.lineTo(d.x*2,d.y);l.lineTo(d.x,d.y*2);l.lineTo(0,d.y);l.lineTo(d.x,0);l.strokeStyle="black";l.stroke();a=document.createElement("img");a.src=n.toDataURL("image/png").replace("image/png","image/octet-stream");a.onload=m}function b(l,p,n,q){this.map=l;this.walkables=p;this.gridCellsDimensions=n;d={x:n.w/2,y:n.h/2};this.mapSize={w:l.length*n.w,h:l.length*n.h};this.objects={};for(var r in q){this.addObject(f(q[r]))}this.frame=0;this.tick=0;this.timePerFrame=16;this.maxFrame=2;h+=this.maxFrame;this.images=new Array(this.maxFrame);this.highlightedCell=null}b.prototype.getObject=function(l){var m=l.x+l.y;if(!this.objects[m]){return null}return this.objects[m][l.x+"-"+l.y]};b.prototype.addObject=function(l,m){if(!m){m={x:l.x,y:l.y}}var n=m.x+m.y;if(!this.objects[n]){this.objects[n]={}}this.objects[n][m.x+"-"+m.y]=l};b.prototype.moveObject=function(n,m){if(n.x==m.x&&n.y==m.y){return}var l=n.x+n.y;this.addObject(this.objects[l][n.x+"-"+n.y],m);delete this.objects[l][n.x+"-"+n.y];if(!this.objects[l]){delete this.objects[l]}};b.prototype.pixelsToCoords=function(n,q){var p=this.gridCellsDimensions.w/2,m=this.gridCellsDimensions.h/2,o=(n/p+q/m)/2-this.map.length/2,l=(q/m-n/p)/2+this.map.length/2;if(o<0||l<0){return null}else{return{x:0|o,y:0|l}}};b.prototype.coordsToPixels=function(l,m){return{x:(this.mapSize.w-(m-l)*this.gridCellsDimensions.w)/2,y:(l+m+1)*this.gridCellsDimensions.h/2}};b.prototype.update=function(){this.tick++;if(this.tick==this.timePerFrame){this.tick=0;this.frame=(this.frame+1)%this.maxFrame}};b.prototype.getNeighbours=function(q){var m=this.neighbourAt(q,"up"),l=this.neighbourAt(q,"right"),p=this.neighbourAt(q,"down"),o=this.neighbourAt(q,"left"),n=[];if(m){n.push(m)}if(l){n.push(l)}if(p){n.push(p)}if(o){n.push(o)}return n};b.prototype.neighbourAt=function(l,u){function o(y){var A=y.x,z=y.y,x;if(z>=0&&z<s.map.length&&A>=0&&A<s.map[z].length){x=s.map[z][A];if(x!==null&&s.walkables[z][A]){return{x:A,y:z,value:x}}}return null}var m=this.map[l.y][l.x],n=i.sprites[m].neighbours[u],r={x:l.x+n.x,y:l.y+n.y},q,w,t,v,s=this,p;w=o(r);if(w===null&&u=="left"){q=i.sprites[i.SPRITES_ACCESS.STAIR].neighbours.right;t={x:l.x-q.x,y:l.y-q.y};v=o(t);if(v&&v.value==i.SPRITES_ACCESS.STAIR){w=v}}p=this.getObject(r);if(p&&!p.canBeTaken){w=null}return w};b.prototype.prerender=function(m,A){var t=document.createElement("canvas"),B=t.getContext("2d");t.width=this.gridCellsDimensions.w*(this.map.length+1);t.height=this.gridCellsDimensions.h*(this.map.length+1);var w=0,v=0,s,l=0,o=0,u=this.map.length-1,p,z=0,r=this;function n(){z++;k++;c.Events.fire("resourceloaded",[k,h]);if(z==r.maxFrame){A()}}c.Events.fire("resourceloaded",[k,h]);for(var q=0;q<this.maxFrame;q++){t.width=t.width;this.images[q]=document.createElement("img");w=0;v=0;l=0;o=0;while(w<=u&&v<=u){s=this.coordsToPixels(w,v);if(this.map[v][w]!==null){p=i.sprites[this.map[v][w]];if(p.animation!==undefined){p=p.animation[q]}B.drawImage(i.spriteResource,p.x,p.y,p.w,p.d,s.x-d.x,s.y-d.y,p.w,p.d);if(m&&this.isWalkableCell({x:w,y:v})){B.beginPath();B.moveTo(s.x-d.x,s.y);B.lineTo(s.x,s.y-d.y);B.lineTo(s.x+d.x,s.y);B.lineTo(s.x,s.y+d.y);B.fillStyle="rgba(246, 44, 197, 0.5)";B.strokeStyle="black";B.fill();B.stroke()}}if(w==l){if(l<u){l++}else{o++}v=l;w=o}else{v--;w++}}this.images[q].src=t.toDataURL("image/png").replace("image/png","image/octet-stream");this.images[q].onload=n}j(n)};b.prototype.highlight=function(l){this.highlightedCell=l&&this.coordsToPixels(l.x,l.y)};b.prototype.draw=function(m){var o=m.adapt({x:0,y:0}),n=this.images[this.frame],l;g.drawImage(n,0,0,n.width,n.height,o.x,o.y,n.width,n.height);if(this.highlightedCell){l=m.adapt(this.highlightedCell);g.drawImage(a,l.x-d.x,l.y-d.y)}};b.prototype.drawObjects=function(l){var n,m;for(n in this.objects){for(m in this.objects[n]){this.objects[n][m].draw(l,this)}}};b.prototype.isWalkableCell=function(m){if(!m){return false}var l=this.getObject(m);return this.map[m.y]!==undefined&&this.map[m.y][m.x]!==undefined&&this.map[m.y][m.x]!==null&&this.walkables[m.y][m.x]&&(!l||l.canBeTaken)};return b});loader.addModule("mouse","B","canvas",function(g,d){var b=false,e=false,a;function c(i){var h=[i[0]-a[0],i[1]-a[1]];a=i;g.Events.fire("mousedrag",h)}function f(l){var k=d.canvas.getBoundingClientRect(),h=document.documentElement,j=l.clientX-k.left-h.scrollLeft,i=l.clientY-k.top-h.scrollTop;return[j,i]}d.canvas.addEventListener("mousedown",function(h){b=true;a=f(h)});d.canvas.addEventListener("mousemove",function(i){var h=f(i);g.Events.fire("mousemove",h);if(!b){return}e=true;c(h)});d.canvas.addEventListener("touchstart",function(h){var i=h.changedTouches[0];a=f(i)},false);d.canvas.addEventListener("touchmove",function(h){h.preventDefault();var j=h.changedTouches[0],i=f(j);c(i)},false);d.canvas.addEventListener("click",function(h){b=false;if(e){e=false;return}g.Events.fire("click",f(h))},false)});loader.addModule("particles",function(){var b={},a={DEAD:0,ALIVE:1},c=1000;b.Particle=function(d,f,e){this.maxLife=e;this.life=this.maxLife;this.position=d;this.speed=f;this.state=a.ALIVE;this.color=[parseInt(Math.random()*255),parseInt(Math.random()*255),parseInt(Math.random()*255)]};b.Particle.prototype.update=function(){if(this.state==a.DEAD){return}this.life--;if(this.life<=0){this.state=a.DEAD}this.position.x+=this.speed.x;this.position.y+=this.speed.y};b.ParticlesManager=function(d){this.maxSize=d;this.particlesCollection=new Array(d);this.nbParticles=0};b.ParticlesManager.prototype.isFull=function(){return this.nbParticles==this.maxSize};b.ParticlesManager.prototype.addParticle=function(d){if(this.isFull()){return}this.particlesCollection[this.nbParticles]=d;this.nbParticles++};b.ParticlesManager.prototype.updateAndDrawParticles=function(g){var f=this;function d(l,h){var k=f.particlesCollection[l];f.particlesCollection[l]=f.particlesCollection[h];f.particlesCollection[h]=k}var e=0;while(e<this.nbParticles){this.particlesCollection[e].update();if(this.particlesCollection[e].state==a.DEAD){this.nbParticles--;d(e,this.nbParticles)}else{g(this.particlesCollection[e]);e++}}};return b});loader.addModule("sky","particles","canvas",function(a,c){var d={nbResources:1},b=c.getContext(),f,e=new a.ParticlesManager(20);d.loadResources=function(g){f=new Image();f.onload=g;f.src="images/cloud.png"};d.update=function(){var k=Math.random(),i,h,g,m,l,j;if(k>0.9&&!e.isFull()){g={x:-f.width,y:c.canvas.height*Math.random()};m={x:Math.random()*2,y:0};l=10000;i=new a.Particle(g,m,l);j=Math.max(0.2,Math.random());i.displayWidth=f.width*j;i.displayHeight=f.height*j;e.addParticle(i)}};d.draw=function(g){b.fillStyle="#AEE8FB";b.fillRect(0,0,g.w,g.h);e.updateAndDrawParticles(function(h){if(h.position.x>g.w||h.position.y>g.h){return}b.drawImage(f,0,0,f.width,f.height,h.position.x,h.position.y,h.displayWidth,h.displayHeight)})};return d});loader.executeModule("main","B","sky","canvas","sprites","pathFinding","camera","map","character","level","message","GUI","screenSize",function(o,x,g,t,D,s,i,k,f,z,l,n){var w=false,H,q,y,J=60,c=1000/J,F,j,u,a=null,b,G,p="#0069b1",d;function h(N){var m=t.nbResources+x.nbResources,B=0;function M(){B++;o.Events.fire("resourceloaded",[B,m]);if(B==m){N()}}o.Events.fire("resourceloaded",[B,m]);t.loadResources(M);x.loadResources(M)}function r(m){g.resize(m);s.w=g.getWidth();s.h=g.getHeight()}function K(){x.draw(s);H.draw(s,w);H.drawObjects(s);if(w){s.draw();g.getContext().font="12px Arial";g.getContext().fillStyle="black";g.getContext().fillText(u+" fps\n",10,20);g.getContext().fillText("screen size: "+JSON.stringify(n.get()),10,30);if(d){g.getContext().fillText("hovered: "+JSON.stringify(d),10,40)}}}function E(){requestAnimationFrame(E);var m=Date.now(),B=m-y;if(B>c){y=m-(B%c);if(w){B=m-F;if(B>1000){F=m;u=j;j=0}else{j++}}H.update();q.update(H);s.update();x.update();K()}}function I(m){if(a){return}a=o.$id(m);o.removeClass(a,"hidden")}function v(){if(a){o.addClass(a,"hidden");a=null}}function L(){return a}function e(){o.Events.on("mousemove",null,function(M,B){if(L()){return}var N=s.toWorldCoords({x:M,y:B}),m=H.pixelsToCoords(N.x,N.y);d=m;if(H.isWalkableCell(m)){H.highlight(m)}else{H.highlight(null)}});o.Events.on("mousedrag",null,function(m,B){if(L()){return}s.setPosition({x:s.x-m,y:s.y-B});s.setSubject()});o.Events.on("click",null,function(M,B){if(L()){return}var N=s.toWorldCoords({x:M,y:B}),m=H.pixelsToCoords(N.x,N.y),O;z.hide();if(!H.isWalkableCell(m)){return}O=D.astar(H,q.cell,m);if(O.length){q.setPath(O);s.setSubject(q)}},false);o.Events.on("message",null,function(m){z.show(m)});o.Events.on("contactsent",null,function(){v();o.Events.fire("message",["Your message has been successfully sent"])});document.addEventListener("keydown",function(B){if(L()){if(B.keyCode==27){v()}return}var m;if(~[37,38,39,40].indexOf(B.keyCode)){if(B.keyCode===38){m=H.neighbourAt(q.cell,"up")}else{if(B.keyCode===39){m=H.neighbourAt(q.cell,"right")}else{if(B.keyCode===40){m=H.neighbourAt(q.cell,"down")}else{if(B.keyCode===37){m=H.neighbourAt(q.cell,"left")}}}}if(m!==null){q.setPath([m]);s.setSubject(q)}}})}function C(){var M=o.$sel("#menu li.frame-button a"),O=o.$sel(".frame .close-button"),B,m;function N(P){return function(){I(P.getAttribute("rel"))}}for(B=0;B<M.length;B++){o.on(M[B],"click",N(M[B]))}for(m in O){o.on(O[m],"click",v)}}function A(){document.body.removeChild(o.$id("intro"));l.tabs();l.collapsable();H=new i(f.ground,f.walkables,f.gridCellsDimensions,f.objects);r(n.get());b=g.getWidth()/5;G=3*b;z.init();o.Events.on("resize",null,r);o.Events.on("resourceloaded",null,function(m,B){l.progressBar(b,g.getHeight()/2,G,30,m/B,p,"white",p)});h(function(){H.prerender(w,function(){o.removeClass("hud","hidden");C();q=new k();q.setCell(H,12,10);s.setPosition(q);e();y=Date.now();F=Date.now();j=0;E()})})}o.on("start","click",function(){A();(function(m,B){document.onkeyup=function(M){B=((M||self.event).keyCode-37)==[1,1,3,3,0,2,0,2,29,28][B]&&(B==9&&m()||B+1)||0}})(function(){o.addClass(g.canvas,"hidden");o.addClass("hud","hidden");o.removeClass("credits","hidden")},0)})});loader.executeModule("contactForm","B",function(b){var a=b.$id("contact-form");b.on(a,"submit",function(f){f.preventDefault();var c=window.location.protocol+"//"+window.location.host+"/contact",d={from:a.from.value,message:a.message.value};b.Ajax.request(c,{200:function(){a.reset();b.Events.fire("contactsent")},400:function(h){var e=JSON.parse(h.response),g=e.error||"An error occured";b.$id("error-form").innerHTML=g},500:function(){b.$id("error-form").innerHTML="An error occured"},502:function(){var e="The server seems to have some issues, but don't worry, you can still find me on linkedin (https://uk.linkedin.com/pub/ghislain-rodrigues/45/68a/322)";b.$id("error-form").innerHTML=e}},null,"POST",JSON.stringify(d))})});